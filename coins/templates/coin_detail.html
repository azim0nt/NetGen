<!-- coins/coin_detail.html -->

{% extends "base.html" %}

{% block content %}
<h1>{{ coin.name }}</h1>
<p>Символ: {{ coin.symbol }}</p>
<p>Рыночная капитализация: {{ coin.market_cap }} USDT</p>
<p>Общее количество монет: {{ coin.total_supply }}</p>
<p>Текущая цена: {{ coin.current_price }} USDT</p>

<form method="post" action="{% url 'buy_coin' coin.id %}">
    {% csrf_token %}
    <input type="number" name="amount" step="0.01" min="0" placeholder="Количество монет" required>
    <button type="submit">Купить</button>
</form>

<form method="post" action="{% url 'sell_coin' coin.id %}">
    {% csrf_token %}
    <input type="number" name="amount" step="0.01" min="0" placeholder="Количество монет" required>
    <button type="submit">Продать</button>
</form>

<!-- График цен -->
<div id="chart"></div>

<!-- Преобразуем данные в JSON и храним в скрытом скрипте -->
<script id="prices-data" type="application/json">
    {{ prices|safe }}
</script>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
const pricesDataElement = document.getElementById('prices-data');
if (pricesDataElement) {
    const prices = JSON.parse(pricesDataElement.textContent);
    console.log(prices)
    var options = {
        series: [{
            name: "Price",
            data: prices
        }],
        chart: {
            type: 'line',
            height: 350,
            width:350,
            zoom: {
                enabled: true // Включаем возможность зумирования
            }
        },
        xaxis: {
            type: 'datetime',
            tickAmount: 10, // Настройка количества делений по оси X
            labels: {
                datetimeFormatter: {
                    year: 'yyyy',
                    month: "MMM 'yy",
                    day: 'dd MMM',
                    hour: 'HH:mm'
                }
            }
        },
        yaxis: {
            min: 0,
            labels: {
                formatter: function (value) {
                    return value.toFixed(2); // Форматирование значений на оси Y
                }
            }
        },
        tooltip: {
            x: {
                format: 'dd MMM yyyy HH:mm' // Формат отображения даты и времени в тултипе
            },
            y: {
                formatter: function (value) {
                    return value.toFixed(2); // Форматирование значений на оси Y
                }
            }
        }
    };

    var chart = new ApexCharts(document.querySelector("#chart"), options);
    chart.render();
}
</script>
{% endblock %}
